<html>
  <head>
	<title>Moa</title>
  </head>
  <link rel="stylesheet" href="moa.css">
  <body>
	<div id="menu">
	  <center>
		<a href="index.html">
		  <img id="menulogo" align="middle" src="moa_logo_smaller.png">
		</a>
	  </center>
	  <ul>
		<li>
		  <a href="introduction.html">Introduction</a>
		</li>
		<li>
		  <a href="installation.html">Installation</a>
		</li>
		<li>
		  <a href="using.html">Usage</a>
		</li>
		<li>
		  <a href="gbrowse.html">Gbrowse</a>
		</li>
		<li>
		  <a name="chapter_couchdb" href="couchdb.html">Couchdb</a>
		</li>
		<li>
		  <a href="extending.html">Extend Moa</a>
		</li>
		<li>
		  <a href="reference.html">Reference</a>
		</li>
	  </ul>
	  <small>
		<a href="manual.pdf">
		  download this manual in pdf format
		</a>
	  </small> 
   </div>
<div id="content">
<h1 id="chapterTitle">Using Couchdb with Moa</h1>
<p
>Couchdb  is a novel type of database that is almost copmletely unlike a SQL database. In it's simplest form it is a high performance key-value datastore. Moa uses Couchdb to store information on all analyses performed by Moa. This means that for each job that Moa performs, a record is created in the Couchdb database. This record has a unique identifier, called <code
  >jid</code
  >. Moa creates jids on the fly by combining the template name, the directory name and a unique identifier (to prevent collisions). These names are not always very descriptive, so it is advisable to set a jid manually. This is possible using the following command (do not use spaces!):</p
><pre
><code
  >make set jid=SensibleName
</code
  ></pre
><p
>Each time Moa executes, the analysis record in Couchdb is updated. The record contains all parameters used, the type of analysis done and the location (current directory) of the analysis. It is possible to update the couchdb record without running the analysis using:</p
><pre
><code
  >make register
</code
  ></pre
><p
>Moa/Couchdb records are a set of key/value pairs, that look like this:</p
><p
>The most important application of Couchdb in Moa is to refer to other jobs using Couchdb identifiers. In a Moa project without couchdb references to the output of other jobs is done by defining the path to that analysis. If, at a certain moment, the project structure needs to be rearranged, it can be hard to discover which path references need to be updated. Use of couchdb solves this, instead of refering to a path, it is now possible to refer to a jid / value combination.</p
><p
>allows a user to refer to another Moa job by the identifier, as opposed to using (relative) directories. The biggest advantage is that is now possible to shuffle your directories around without breaking the pipeline structure.</p
><div id="configuration"
><h2
  >Configuration</h2
  ><p
  >Please follow the couchdb documentation to set up a local server. Moa has been developed with the latest version of Couchdb (currently 0.9.1). It might be possible to use an older version, but that has not been tested.</p
  ><p
  >All Moa configuration for couchdb is done in <code
    >$MOABASE/etc/moa.conf.mk</code
    >.</p
  ><p
  >The default setting of Moa is to not use couchdb. This can be overrided by setting: usecouchdb=T</p
  ><p
  >Moa expects a Couchdb server on <code
    >localhost:5984</code
    >. This can be overridden using: couchserver=other.server:portnumber</p
  ><p
  >All information</p
  ></div
><div id="using-couchdb-with-moa"
><h2
  >Using couchdb with Moa</h2
  ><p
  >Instead of using !make set key=value!, couchdb variables are set using !make cset jid^key!</p
  ><p
  >LocalWords: jid SensibleName</p
  ></div
>
</div></body></html>
