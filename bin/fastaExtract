#!/usr/bin/env python
"""
Extract a set of sequences from a multifasta file
"""

import time
import sys
import copy
import optparse

def fastareader(f):
    F = open(f)
    name, seq = "", []
    while True:
        l = F.readline()
        if not l: break
        
        l = l.strip()
        if not l: continue

        if l[0] == '>':
            if name and seq:
                yield name, "".join(seq)
            seq = []
            name = l[1:]
                        
        else:
            seq.append("".join(l.split()).lower())

    if name and seq:
        yield name, "".join(seq)

    F.close()

parser = optparse.OptionParser()

parser.add_option('-l', '--list', dest='list',
    help = 'list of ids to extract')

parser.add_option('-f', '--fasta', dest='fasta',
    help = 'fasta file to extract from')

(options, args) = parser.parse_args()
if not options.list:
    raise "Must define a list!"
if not options.fasta:
    raise "Must define a fasta file!"

def log(m):
    sys.stderr.write("fastaextractor: %s\n" % m)

ids = [x.strip().split()[0] for x in open(options.list).readlines()]
log("read %d ids" % len(ids))
        
i = 0
for name,seq in fastareader(options.fasta):
    if not name in ids: continue
    i += 1
    print ">%s" % name
    print "%s" % seq

log("written %d sequences" % i)


