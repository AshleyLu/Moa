<!--
#
#     Copyright 2009 Mark Fiers
#
#    This file is part of Moa 
#
#    Moa is free software: you can redistribute it and/or modify
#    it under the terms of the GNU General Public License as published by
#    the Free Software Foundation, either version 3 of the License, or
#    (at your option) any later version.
#
#    Moa is distributed in the hope that it will be useful,
#    but WITHOUT ANY WARRANTY; without even the implied warranty of
#    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
#    GNU General Public License for more details.
#
#    You should have received a copy of the GNU General Public License
#    along with Moa.  If not, see <http://www.gnu.org/licenses/>.
#
#    See: http://github.com/mfiers/Moa/
-->

<html>
<head>

<style type="text/css">

body {
   font-family:"Trebuchet MS",Verdana,Helvetica,Arial,sans-serif !important;
   font-size: 9px;
}
div#menu {
  position:absolute;
  top: 0px;
  right: 0px;
  left: 0px;
  height: 20px;
  background-color: #204a87;
  color: white;
  font-size: 14px;
}

div#tree {
  position:absolute;

  top: 20px;
  left: 0px;
  width: 200px;
  bottom: 20px;

  background-color: white;
  border-right: 3px solid #4e9a06;
  overflow: auto;
  margin: 0px;
}

div#message {
  z-index:1;
  position: absolute;
  color: white;
  left: 0px;
  bottom: 0px;
  height: 20px;
  right: 0px;
  background-color: #a40000; 
}

div#content {
  position: absolute;
  left: 200px;
  top: 20px;
  right: 0px;
  bottom: 20px;
  background-color: #eeeeec;
  overflow: auto;
}

table {
  font-size: 12px;
}
table#vars td {
  margin: 0px;
  padding: 3px;
  border-bottom: 1px dotted black;
}

table#vars th {
  text-align:left;
  width:200px;
  margin: 0px;
  padding: 3px;
  border-right: 1px dotted black;
  border-bottom: 1px dotted black;
}

textarea#messagebox {
  width: 100%;
  height: 20px;
  border: 0px;
  background-color: inherit;
  color: white;
}

</style>

<link rel="stylesheet" href="css/treeview.css" />
<link rel="stylesheet" href="css/treeview-screen.css" />

<!-- includes - jquery -->
<script type="text/javascript" src="js/jquery.js"></script>

<!-- includes - jquery treeview plugin -->
<script type="text/javascript" src="js/jquery.cookie.js"></script>
<script type="text/javascript" src="js/jquery.treeview.min.js"></script>
<script type="text/javascript" src="js/jquery.treeview.async.js"></script>

<script type="text/javascript">
    currentDir = null;

$(document).ready(function(){

    $("#moatree").treeview({
	url: "treeview.cgi",
	  persist: "cookie",
	  speed: 1,
	  toggle: function() {
	  newDir = this.id;
	  if (newDir != currentDir) {
	    currentDir = newDir;
	    setContent(newDir); }
	}
      });
      
    $("#message").click(function() {
	
	if ($(this).css("height") == "200px") {
	  console.log("minimize messages " + $(this).css("height"));
	  $(this).css("height", 20);
	  $("div#content").css("bottom", 20);
	  $("div#tree").css("bottom", 20);
	} else {
	  console.log("maximize messages" + $(this).css("height"));
	  $(this).css("height", 200);
	  $("div#content").css("bottom", 200);
	  $("div#tree").css("bottom", 200);
	}
      });
    
    
  });

logmessage = function(txt) {
  $("textarea#messagebox").append("\n" + txt);
};

    //Set the content frame with the new path
    setContent = function(path) {
    $("#dirname").text(path);
    $.getJSON("nodeinfo.cgi?path=" + path,
	    function(data){
	      processTargets(data.targets);
	      processVars(data.vars);
	      console.log(data.error);
	      console.log(data.vars);
	      logmessage(data.message);
          });
	}

    processTargets = function(targets) {
	    var tf = $('span#targets');
		tf.empty();
		for (var t in targets) {
			if ( t > 0 ) {
			    tf.append(", ");
			} 
			tf.append(targets[t]);
			
	   }		
	}

    processVars = function(vars) {
	   vf = $('#vars');
	   vf.empty()
	   vf.append("<table id='vars'>");
	   for (var v in vars) {
	     row = "<tr></tr>" + 
	       "<th>" + v + "</th>" + 
	       "<td id=" + v + " class='varval'>" + 
	       vars[v] + "</td>";
	     $('#vars > table').append(row)
	   }	   
	}

</script>


<title>Moa web interface</title>

</head><body>

<div id="menu">
Moa <span id="dirname">/</span>
</div>

<div id="tree">
  <ul id="moatree"></ul>
</div>

<div id="content">
  <b>Targets:</b> <span id="targets"></span>
  <h4>Variables</h4>
  <div id="vars">
  </div>
</div>

<div id="message">
  <textarea id="messagebox">Welcome to moa web interface</textarea>
</div>

</body></html>
